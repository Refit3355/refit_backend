<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.refit.app.domain.analysis.mapper.AnalysisMapper">

  <!-- 헬스 워치 건강 데이터 조회 -->
  <select id="selectHealthInfo" parameterType="long"
    resultType="com.refit.app.domain.analysis.dto.AnalysisHealthInfoDto">
    SELECT MEMBER_ID, BLOOD_PRESSURE, BLOOD_GLUCOSE,
    TOTAL_CALORIES_BURNED, SLEEPSESSION
    FROM HEALTH_INFO
    WHERE MEMBER_ID = #{memberId}
  </select>

  <!-- 피부 고민 데이터 조회 -->
  <select id="selectSkinConcern" parameterType="long"
    resultType="com.refit.app.domain.analysis.dto.AnalysisSkinConcernDto">
    SELECT SKIN_TYPE, ATOPIC, ACNE, WHITENING, SEBUM, INNER_DRYNESS,
    WRINKLES, ENLARGED_PORES, REDNESS, KERATIN
    FROM SKIN_CONCERN
    WHERE MEMBER_ID = #{memberId}
  </select>

  <!-- 건강 고민 데이터 조회 -->
  <select id="selectHealthConcern" parameterType="long"
    resultType="com.refit.app.domain.analysis.dto.AnalysisHealthConcernDto">
    SELECT EYE_HEALTH, FATIGUE, SLEEP_STRESS, IMMUNE_CARE,
    MUSCLE_HEALTH, GUT_HEALTH, BLOOD_CIRCULATION
    FROM HEALTH_CONCERN
    WHERE MEMBER_ID = #{memberId}
  </select>

  <!-- 헤어 고민 데이터 조회 -->
  <select id="selectHairConcern" parameterType="java.lang.Long"
    resultType="com.refit.app.domain.analysis.dto.AnalysisHairConcernDto">
    SELECT HAIR_LOSS, DAMAGED_HAIR, SCALP_TROUBLE, DANDRUFF
    FROM HAIR_CONCERN
    WHERE MEMBER_ID = #{memberId}
  </select>

  <resultMap id="IngredientRuleMap" type="com.refit.app.domain.analysis.dto.IngredientRule">
    <id column="INGREDIENT_RULE_ID" property="ingredientRuleId"/>
    <result column="INGREDIENT_NAME" property="ingredientName"/>
    <result column="INGREDIENT_CATEGORY" property="ingredientCategory"/>
    <result column="DESCRIPTION" property="description"/>
  </resultMap>

  <select id="selectByNames" parameterType="list" resultMap="IngredientRuleMap">
    SELECT INGREDIENT_RULE_ID, INGREDIENT_NAME, INGREDIENT_CATEGORY, DESCRIPTION
    FROM INGREDIENT_RULE
    WHERE REPLACE(REGEXP_REPLACE(UPPER(INGREDIENT_NAME), '[·,/|;:\\.\\-（）()\"''\\[\\]]', ''), ' ',
    '') IN
    <foreach collection="names" item="n" open="(" separator="," close=")">
      REPLACE(REGEXP_REPLACE(UPPER(#{n}), '[·,/|;:\\.\\-（）()\"''\\[\\]]', ''), ' ', '')
    </foreach>
  </select>

  <select id="selectMemberNickname" parameterType="long" resultType="string">
    SELECT NICKNAME FROM MEMBER WHERE MEMBER_ID = #{memberId}
  </select>

</mapper>
